## Uroven Admin — простая админ-панель Supabase для одной таблицы

Минималистичная админ-панель на Next.js для таблицы `products` в Supabase. Она безопасно отображает HTML, позволяет редакторам обновлять описания через легкий редактор форматированного текста и подтверждать контент с помощью полей аудита.

### Возможности

-   Просмотр таблицы `products` с пагинацией (50 записей на страницу) и встроенным фильтром: отображаются только строки, где `description_added = true`
-   Просмотр продуктов, подтвержденных текущим пользователем, на специальной странице "Подтвержденные продукты"
-   Панель статистики администратора для пользователей с особым доступом (настроенным в коде)
-   Безопасное отображение HTML для полей `short_description` и `description` (с санитизацией)
-   Встроенный редактор форматированного текста (contentEditable) с компактной панелью инструментов: Жирный, Курсив, Подчеркнутый, H2, Параграф, Упорядоченные/Неупорядоченные списки, Ссылка, Очистка форматирования
-   Предварительный просмотр в реальном времени внутри модального окна редактора; HTML санитизируется перед сохранением
-   Действие "Подтвердить описание" с сохранением email текущего пользователя
-   Визуальные значки для готовности к PIM и статуса подтверждения
-   Аутентификация Supabase (email/пароль): вход и выход

### Технический стек

-   Next.js (App Router, TypeScript, Tailwind CSS)
-   Supabase JS SDK
-   HTML санитизация: `isomorphic-dompurify`

### Начало работы

1. Установка зависимостей

```bash
npm i
```

2. Создание файла `.env`

```bash
NEXT_PUBLIC_SUPABASE_URL=your_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_public_anon_key
```

3. Локальный запуск

```bash
npm run dev
```

Откройте `http://localhost:3000`, войдите в систему на странице `/login`, затем перейдите на `/admin`, `/products` или `/approved-products`, чтобы увидеть ваши подтвержденные элементы

### Схема базы данных (products)

Основные столбцы, используемые приложением, включают: `row_number`, `id` (PIM id), `uid` (uuid), `product_name`, `short_description`, `description`, `description_added`, `push_to_pim`.

Это приложение также ожидает следующие столбцы аудита/подтверждения. Запустите в SQL-редакторе Supabase:

```sql
-- 1) Новые столбцы
alter table public.products
  add column if not exists created_at timestamptz not null default now(),
  add column if not exists updated_at timestamptz not null default now(),
  add column if not exists description_confirmed boolean not null default false,
  add column if not exists confirmed_by_email text;

-- 2) Триггер updated_at
create or replace function public.set_updated_at()
returns trigger
language plpgsql
as $$
begin
  new.updated_at = now();
  return new;
end;
$$;

drop trigger if exists trg_set_updated_at on public.products;
create trigger trg_set_updated_at
before update on public.products
for each row
execute function public.set_updated_at();
```

### Использование редактора

-   Нажмите "Редактировать краткое описание" или "Редактировать полное описание" на карточке продукта
-   Используйте панель инструментов для форматирования текста (Жирный/Курсив/Подчеркнутый, H2/P, списки, ссылка)
-   Просматривайте изменения в режиме реального времени; нажмите "Сохранить" для сохранения
-   Нажмите "Подтвердить описание", чтобы отметить его как одобренное; ваш email будет сохранен
-   Просматривайте все продукты, которые вы подтвердили, перейдя в "Мои подтверждения" в заголовке или напрямую по адресу `/approved-products`
-   Пользователи-администраторы могут просматривать таблицу статистики, показывающую количество подтверждений для каждого пользователя

### Favicon и брендинг

Приложение использует `src/app/favicon.ico`. Замените его своим значком, чтобы обновить favicon. На главной странице отображается логотип компании из `src/images/logo.png`.

### Функции администратора

Для пользователей, чьи email-адреса включены в массив `ADMIN_EMAILS` в файле `src/app/approved-products/page.tsx`:

-   Просмотр статистической панели в верхней части страницы "Подтвержденные продукты"
-   Просмотр количества продуктов, подтвержденных каждым пользователем в системе
-   Данные отсортированы по количеству подтверждений в порядке убывания
-   Чтобы добавить больше администраторов, обновите массив `ADMIN_EMAILS` в исходном коде
